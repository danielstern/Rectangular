<doctype HTML>

    <html ng-app='BallAgentApp' ng-controller='myDemoCtrl'>

    <head>
        <title>Shapemaker: Enjoy Shapes</title>

        <script src="lib/angular.js"></script>
        <script src="lib/jquery.js"></script>
        <script src="lib/underscore.js"></script>
        <script src="lib/mousetrap.js"></script>
        <script src="lib/Box2dWeb-2.1.a.3.js"></script>
        <script src="js/util.js"></script>
        <script src="js/Rectangular.js"></script>
        <script src="BallAgent/BallAgent.js"></script>
        <script src="BallAgent/BallAgentLevels.js"></script>
        <script src="BallAgent/BallAgentHero.js"></script>
        <script src="BallAgent/BallAgentModels.js"></script>
        <script src="js/ngrStage.js"></script>
        <script src="js/ngrState.js"></script>
        <script src="js/ngrWorld.js"></script>
        <script src="js/ngrDisplay.js"></script>
        <script src="js/ngrLoop.js"></script>
        <script src="js/ngrEnvironment.js"></script>
        <script src="js/ngrModels.js"></script>
        <script src="js/ngrBox.js"></script>
        <script src="lib/angular.audio.js"></script>
        <script type="text/javascript" src="lib/easel.js"></script>
        <script type="text/javascript" src="lib/create.js"></script>

        <script>
        var b2Vec2 = Box2D.Common.Math.b2Vec2,
            b2AABB = Box2D.Collision.b2AABB,
            b2BodyDef = Box2D.Dynamics.b2BodyDef,
            b2Body = Box2D.Dynamics.b2Body,
            b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
            b2Fixture = Box2D.Dynamics.b2Fixture,
            b2World = Box2D.Dynamics.b2World,
            b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
            b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
            b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
            b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef,
            b2Shape = Box2D.Collision.Shapes.b2Shape,
            b2RevoluteJointDef = Box2D.Dynamics.Joints.b2RevoluteJointDef,
            b2Joint = Box2D.Dynamics.Joints.b2Joint,
            b2PrismaticJointDef = Box2D.Dynamics.Joints.b2PrismaticJointDef;
        </script>

        <link rel="stylesheet" type="text/css" href="styles/ballAgent.css">
        <link rel="stylesheet" type="text/css" href="styles/ngr.css">
        <link rel="stylesheet" type="text/css" href="styles/animate.css">

    </head>

    <body>


        <div class='main'>
            <canvas ng-stage id='gameCanvas' width='650' height='450'></canvas>
        </div>
        <shapemaker shape='box' properties='height width restitution density'></shapemaker>
        <shapemaker shape='circle' properties='radius restitution density'></shapemaker>
       
    </body>

    </html>

    <!-- ZOR -->
    <script>
    angular.module("BallAgentApp", ['ngAudio', 'Rectangular'])
        .controller('myDemoCtrl', function($scope, $element, ngrEnvironment, ngAudio) {

            ngrEnvironment.init({
                scale: 'auto',
                worldHeight: 30
            });

      

        })
        .directive('shapemaker',function(){
            return {
                restrict: 'AE',
                templateUrl:function(elem, atts){
                    return "shapemaker/creator.html";

                },
                scope: {
            
                },
                link: function($scope, $elem, $attr) {
                    console.log("Hey shapemaker!",arguments);
                    $scope.shape = $attr.shape;
                    if ($attr.properties) $scope.properties = $attr.properties.split(' ');
                    //$scope.shape = $attr.shape || 'box';
                },
                controller: function($scope, $attrs, ngrEnvironment) {
                    console.log("This is my scope", $scope);

                    $scope.q = {};
                    var q = $scope.q;
                    q.height = 1;
                    q.width = 1;
                    q.radius = 0.5;
                    q.restitution = 0.3;
                    q.density = 0.5;
                    
                    $scope.newShape = function(input) {
  //                      console.log('adding new shape,',$attrs.shape);
                        $scope.addShape($attrs.shape);
                    }

                    $scope.addShape = function(shape) {
                      //  console.log("Adding shape",shape, $scope)
                        switch (shape) {
                            case 'box':
                                $scope.addBox();
                                break;
                            case 'circle':
                                $scope.addCircle();
                                break;
                            default:
                                console.error("Unavailable shape,",shape);
                                break;
                        }
                    }
                    
                    $scope.addBox = function() { 
                       // console.log("Adding shape",$scope);
                        ngrEnvironment.add('box',{
                            x:Math.random()*40,
                            height:q.height / 2,
                            width:q.width / 2,
                            restitution:q.restitution,
                            density:q.density,
                        });
                    }

                    $scope.addCircle = function() { 
                        //console.log("Adding shape",$scope);
                        ngrEnvironment.add('circle',{
                            x:Math.random()*40,
                            radius:q.radius,
                            restitution:q.restitution,
                            density:q.density,
                        });
                    }
                }
            }
        })
        .directive('slider',function(){
            return {
                restrict: 'AE',
                link:function() {
                    console.log("hi slider!");
                },
                templateUrl:function(elem, atts){
                    return "shapemaker/slider.html";
                },
            }
        })
    </script>
